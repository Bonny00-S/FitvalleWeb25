@model Dictionary<string, Fitvalle_25.Models.User>
@{
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
    ViewData["Title"] = "Usuarios";
}

<div class="card-fitvalle p-8 rounded-2xl shadow-lg border border-[var(--color-primary)]/30 bg-[var(--color-surface)] text-[var(--color-text-primary)] animate__animated animate__fadeIn">
    @if (TempData["MessageAdmin"] != null)
    {
        <div class="mb-4 bg-[var(--color-success)]/20 text-[var(--color-success)] px-4 py-2 rounded-lg border border-[var(--color-success)]/50 flex items-center gap-2 font-[Poppins]">
            <i data-lucide="check-circle" class="icon active"></i>
            @TempData["MessageAdmin"]
        </div>
    }
    <!-- Encabezado -->
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-bold text-[var(--color-primary)] font-[Poppins] flex items-center gap-2">
            <i data-lucide="users" class="text-[var(--color-primary)]"></i> Usuarios del sistema
        </h2>

        <a asp-action="Register"
           class="bg-[var(--color-success)] hover:bg-emerald-600 text-white font-semibold px-5 py-2 rounded-lg shadow-md transition duration-300 flex items-center gap-2">
            <i data-lucide="user-plus" class="text-white"></i> Registrar Usuario
        </a>
    </div>

    <!-- Tabla -->
    <div class="overflow-x-auto rounded-xl border border-[var(--color-primary)]/20 shadow-lg">
        <table class="w-full text-sm text-left font-[Poppins]">
            <thead class="bg-[var(--color-primary)] text-white uppercase tracking-wide text-xs">
                <tr>
                    <th class="px-4 py-3">Nombre</th>
                    <th class="px-4 py-3">Email</th>
                    <th class="px-4 py-3">Rol</th>
                    <th class="px-4 py-3">Registro</th>
                    <th class="px-4 py-3">Estado</th>
                    <th class="px-4 py-3 text-center">Acciones</th>
                </tr>
            </thead>

            <tbody class="divide-y divide-[var(--color-primary)]/20 bg-[var(--color-background)] text-[var(--color-text-secondary)]">
                @if (Model != null && Model.Any())
                {
                    foreach (var user in Model)
                    {
                        <tr class="hover:bg-[var(--color-primary-hover)]/10 transition duration-300">
                            <td class="px-4 py-3 font-medium text-[var(--color-text-primary)]">@user.Value.Name</td>
                            <td class="px-4 py-3">@user.Value.Email</td>
                            <td class="px-4 py-3 capitalize">@user.Value.Role</td>
                            <td class="px-4 py-3">@user.Value.RegisterDate</td>
                            <td class="px-4 py-3">
                                @if (user.Value.State == 1)
                                {
                                    <span class="px-2 py-1 text-xs font-semibold text-emerald-300 bg-emerald-900/30 rounded-full border border-emerald-600/30 flex items-center justify-center">
                                        <i data-lucide="check-circle" class="w-3 h-3 mr-1"></i> Activo
                                    </span>
                                }
                                else
                                {
                                    <span class="px-2 py-1 text-xs font-semibold text-red-300 bg-red-900/30 rounded-full border border-red-600/30 flex items-center justify-center">
                                        <i data-lucide="x-circle" class="w-3 h-3 mr-1"></i> Inactivo
                                    </span>
                                }
                            </td>

                            <td class="px-4 py-3 text-center space-x-2">
                                <a asp-action="Edit" asp-route-uid="@user.Key"
                                   class="inline-flex items-center gap-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md text-xs font-semibold shadow transition duration-300">
                                    <i data-lucide="edit-2" class="w-3 h-3"></i> Editar
                                </a>

                                <button type="button"
                                        onclick="openDeleteModal('@user.Key')"
                                        class="inline-flex items-center gap-1 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md text-xs font-semibold shadow transition duration-300">
                                    <i data-lucide="trash-2" class="w-3 h-3"></i> Eliminar
                                </button>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center py-6 text-[var(--color-text-secondary)] italic">
                            No hay usuarios registrados.
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- 🔸 MODAL DE CONFIRMACIÓN -->
<div id="deleteModal" class="fixed inset-0 bg-black/70 flex items-center justify-center hidden z-50">
    <div class="bg-[var(--color-surface)] rounded-xl shadow-2xl border border-[var(--color-primary)]/30 p-8 w-[24rem] animate__animated animate__fadeIn">
        <h3 class="text-xl font-bold text-[var(--color-primary)] mb-3 flex items-center gap-2">
            <i data-lucide="alert-triangle" class="text-yellow-400"></i> Confirmar eliminación
        </h3>
        <p class="text-[var(--color-text-secondary)] mb-6 text-sm">
            ¿Estás seguro de que deseas eliminar este usuario? Esta acción no se puede deshacer.
        </p>

        <form id="deleteForm" method="post" asp-action="DeleteUser">
            <input type="hidden" name="uid" id="deleteUid" />

            <div class="flex justify-end space-x-3">
                <button type="button"
                        onclick="closeDeleteModal()"
                        class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md font-semibold transition">
                    Cancelar
                </button>

                <button type="submit"
                        class="px-4 py-2 bg-red-700 hover:bg-red-800 text-white rounded-md font-semibold shadow flex items-center gap-1">
                    <i data-lucide="trash-2" class="w-3 h-3"></i> Eliminar
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    lucide.replace(); // Inicializa íconos Lucide

    function openDeleteModal(uid) {
        document.getElementById('deleteUid').value = uid;
        document.getElementById('deleteModal').classList.remove('hidden');
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
    }
</script>
