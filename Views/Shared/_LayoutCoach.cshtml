@{
    // Se asume que pasas el usuario desde tu controlador
    var user = ViewBag.User as Fitvalle_25.Models.User;
}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - FITVALLE</title>
    <link rel="icon" type="image/jpeg" href="/images/LogoFITNESS.jpeg">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Tipografía y tema -->
    <link href="~/css/site.css" rel="stylesheet" />
</head>

<body class="bg-[var(--color-background)] text-[var(--color-text-primary)] min-h-screen flex flex-col">

    <!-- HEADER -->
    <header class="header-fitvalle flex justify-between items-center px-6 py-4 shadow-lg">
        <div class="flex items-center gap-3">
            <img src="/images/LogoFITNESS.jpeg" alt="Logo" class="w-10 h-10 rounded-full border-2 border-[var(--color-primary)]">
            <span class="text-xl font-[Poppins] font-bold tracking-wide">FITVALLE COACH</span>
        </div>

        <div class="flex items-center gap-6">

            <!-- ⚙️ Menú de configuración -->
            <div class="relative group">
                <i id="settingsToggle"
                   class="fa-solid fa-gear text-[var(--color-text-secondary)] hover:text-[var(--color-warning)] cursor-pointer transition"></i>

                <div id="settingsMenu"
                     class="hidden absolute right-0 mt-2 w-48 bg-[var(--color-surface)] text-white rounded-lg shadow-lg z-50 border border-[var(--color-primary)]/40">
                    <ul class="py-2 text-sm">
                        <li>
                            <a asp-action="ProfileCoach" asp-controller="Coach" class="block px-4 py-2 hover:bg-[var(--color-primary)] transition">Ver perfil</a>
                        </li>
                        <li>
                            <a asp-action="ChangePassword" asp-controller="Auth"
                               class="block px-4 py-2 hover:bg-[var(--color-primary)] transition">
                                Cambiar contraseña
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- 🧑 Usuario y logout -->
            <div class="flex items-center gap-3 bg-[var(--color-surface)] px-4 py-2 rounded-xl border border-[var(--color-primary)]/40 shadow-md">
                <span class="font-semibold">@User.Identity?.Name</span>

                <!-- Imagen del coach -->
                <a asp-action="ProfileCoach" asp-controller="Coach"
                   class="w-10 h-10 bg-[var(--color-primary)] rounded-full flex items-center justify-center overflow-hidden hover:scale-105 transition-transform duration-200 shadow-md">
                    <img src="@(!string.IsNullOrEmpty(user?.PhotoUrl) ? user.PhotoUrl : "/images/iconUser.png")"
                         alt="Usuario" class="w-8 h-8 object-cover" />
                </a>

                <!-- Icono de logout -->
                <!-- Icono de logout -->
                <form asp-action="Logout" asp-controller="Auth" method="post" class="flex items-center">
                    <button type="submit"
                            class="w-10 h-10 bg-[var(--color-primary)] rounded-full flex items-center justify-center text-white shadow-md transition-transform duration-200 hover:scale-105"
                            title="Cerrar sesión">
                        <i class="fa-solid fa-right-from-bracket text-lg"></i>
                    </button>
                </form>

            </div>
        </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="flex flex-1">
        <!-- SIDEBAR -->
        <aside class="sidebar-fitvalle w-64 p-4 shadow-xl border-r border-[var(--color-primary)]/20">
            <nav class="space-y-2">
                <a asp-action="Dashboard" asp-controller="Coach" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-[var(--color-primary)]/20 transition">
                    <i class="fa-solid fa-house text-[var(--color-primary)]"></i> <span>Inicio</span>
                </a>
                <a asp-action="RequestCustomers" asp-controller="Coach" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-[var(--color-primary)]/20 transition">
                    <i class="fa-solid fa-envelope-open-text text-[var(--color-primary)]"></i> <span>Solicitudes</span>
                </a>
                <a asp-action="MyStudents" asp-controller="Coach" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-[var(--color-primary)]/20 transition">
                    <i class="fa-solid fa-chalkboard-user text-[var(--color-primary)]"></i> <span>Mis Alumnos</span>
                </a>
            </nav>
        </aside>

        <!-- MAIN -->
        <main class="flex-1 p-8 bg-[var(--color-background)]">
            @RenderBody()
        </main>
    </div>

    @RenderSection("Scripts", required: false)

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            lucide.createIcons();

            const toggle = document.getElementById("settingsToggle");
            const menu = document.getElementById("settingsMenu");

            toggle.addEventListener("click", (e) => {
                e.stopPropagation();
                menu.classList.toggle("hidden");
            });

            document.addEventListener("click", (e) => {
                if (!menu.contains(e.target) && !toggle.contains(e.target)) {
                    menu.classList.add("hidden");
                }
            });
        });
    </script>
</body>
</html>
